window.addEventListener("load",function(){var a=document.createElement("div");a.className="playstop";a.id="traquer-playstop";controls=new Controls;a.addEventListener("click",controls.recording.bind(this,controls));document.body.appendChild(a)});var Controls=function(){if(!(this instanceof Controls))return new Controls;this.traquer=new Traquer};
Controls.prototype.recording=function(a,b){var c=a.traquer,d=b.target;c.isRecording?(d.className="playstop",c.stop(),a.timeline.call(a),a.timeline.call(a)):(c.start(),d.className="playstop squared")};
Controls.prototype.timeline=function(){var a=this.traquer.recordedEvents,b=document.querySelector("ol.timeline-container");b||(b=document.createElement("ol"),b.className="timeline-container",document.body.appendChild(b));b.innerHTML="";var c=b.getBoundingClientRect().width,d=a[a.length-1].time,e,g,k=2147E6;for(e in a)if(a.hasOwnProperty(e)){var f=a[e],l=parseInt(100*(f.time/d)),l=parseInt(l*c/100),h="e_"+Math.random().toString(36).substring(3).substr(0,8),m=['<li id="'+h+'"',' style="left: '+l+'px;"',
' class="{css-class}">','<div class="tl-type" style="z-index: '+k++ +'">',"{title}</div><br/>",'<div class="tl-selector" style="z-index: '+k++ +'">',"{selector}</div></li>"].join(""),n="click"==f.type||"keydown"==f.type||"keyup"==f.type||"keypress"==f.type?"red":-1<f.type.indexOf("DOM")?"blue":"default",m=m.replace(/{title}/igm,f.type).replace(/{selector}/igm,f.selector).replace(/{css-class}/igm,n);b.innerHTML+=m;g&&("click"!=f.type&&"keydown"!=f.type&&"keyup"!=f.type&&"keypress"!=f.type&&-1==f.type.indexOf("DOM")&&
l>g-10&&l<g+10)&&(g=b.querySelector("#"+h),h=g.previousSibling,f=window.getComputedStyle(g),h=window.getComputedStyle(h),f=parseInt(f.top.replace("px","")),h=parseInt(h.top.replace("px","")),g.style.cssText+="top: "+(f+(h==f?38:18)+"px")+";");g=l}};Controls.prototype.player=function(){};"use strict";var EventBase=function(a){if(!(this instanceof EventBase))return new EventBase;if(!(a&&a instanceof Traquer))throw Error("Can't instantiate EventBase without Traquer instance!");this.traquer=a};
EventBase.prototype={mouseEvents:function(a,b){var c=new MouseEvent(a.type,a.raw);this.traquer.toggleStopPropagation(a,c);b.dispatchEvent(c)},wheelEvents:function(a,b){for(var c=new WheelEvent("wheel",a.raw);b.scrollHeight<=b.clientHeight&&b.parentNode;)b=b.parentNode;b.dispatchEvent(c)},focusEvents:function(a,b){if(a){var c=-1<a.type.indexOf("FocusIn")?"focus":"blur";if(-1<a.type.indexOf("FocusIn")||-1<a.type.indexOf("FocusOut"))var d=setTimeout(function(){b.dispatchEvent(new FocusEvent(a.type,b));
clearTimeout(d)},1);b.dispatchEvent(new FocusEvent(c,b))}},inputEvents:function(a,b){var c=a.raw,d=a.value;c.srcElement=b;c.target=b;console.log(d);c.keyCode=d.charCodeAt(d.length-1);c.code="Key"+d[d.length-1];evt=this.traquer.fakeEvents.textEvents(a,b);b.dispatchEvent(evt)},textEvents:function(a,b){var c=document.createEvent("TextEvent"),d=a.raw,d=d.code&&-1<d.code.indexOf("Key")?d.code.substr(3):a.value;c.initTextEvent("textInput",!0,!0,null,d,0,"en-US");return c},keyEvents:function(a,b){var c=
a.type,d=a.raw;if(d.code&&-1<d.code.indexOf("Key"))c=new KeyboardEvent(c);else{c=new KeyboardEvent(c,{bubbles:!0,view:null});c.__fake={};for(var e in d)if("isTrusted"!==e&&d.hasOwnProperty(e)){var g=d[e],k=function(a){return this.__fake["sub"+a]}.bind(c,e);Object.defineProperty(c,e,{get:k});c.__fake["sub"+e]=g}}b.dispatchEvent(c)},UIEvents:function(a,b){var c=new UIEvent(a.raw);b.dispatchEvent(c)},selectionEvents:function(a,b){var c=focusEvents(a,b);b.dispatchEvent(c)},empty:function(a,b){var c=document.createEvent("HTMLEvents");
c.initEvent(a.raw,!0,!0);b.dispatchEvent(c)}};"use strict";var Traquer=function(){if(!(this instanceof Traquer))return new Traquer;this.index=0;this.logging=!1;this.recordedEvents=[];this.previousElement=null;this.eventNames="mouseenter mouseleave mouseover mousedown mouseup mouseout click scroll contextmenu wheel focus focusin focusout change input textinput keypress keydown keyup DOMFocusIn DOMFocusOut selectstart selectionchange select DOMActivate".split(" ")};
Traquer.prototype={isEventObservable:function(a){return a&&a.type?-1<this.eventNames.indexOf(a.type):!1},start:function(a){var b=this;b.isRecording=!0;b.recordingStartTime=(new Date).getTime();b.recordedEvents=[];b.mousePosition={x:0,y:0};var c=b.eventNames||[];b.processEventBinded=b.processEvent.bind(b);c.forEach(function(a){document.body.addEventListener(a,b.processEventBinded,!1)});document.addEventListener("mousemove",function(a){b.mousePosition.x=a.x;b.mousePosition.y=a.y});a&&(this.logging=
!0)},stop:function(){var a=this,b=a.eventNames||[];a.processEventBinded&&b.forEach(function(b){document.body.removeEventListener(b,a.processEventBinded,!1)});a.isRecording=!1;return this.recordedEvents},copyEventObject:function(a){var b={},c;for(c in a){var d=typeof a[c];"function"!=d&&"object"!=d&&(b[c]=a[c])}return b},processEvent:function(a){"mousedown"==a.type&&(this.isMouseDown=!0);if(this.isEventObservable(a)||this.isMouseDown){var b={index:this.index,x:this.mousePosition.x,y:this.mousePosition.y,
time:(new Date).getTime()-this.recordingStartTime,raw:this.copyEventObject(a),type:a.type,id:a.target.id,targetType:a.target.tagName?a.target.tagName.toLowerCase():null,value:a.target.value||a.target.text,attrs:function(){var b=[],d;for(d in a.target.attributes)if(a.target.attributes.hasOwnProperty(d))if("style"!==a.target.attributes[d].name&&a.target.attributes[d].value){var e=a.target.attributes[d].value.match(/<.*?[\s\S]*?>[\s\S]*?<\/.*>/g),g=a.target.attributes[d].value.match(/(http:).*/g),k=
a.target.attributes[d].name.match(/data-.*/g);"id"!=a.target.attributes[d].name&&(null==e&&null==g&&null==k)&&b.push(a.target.attributes[d].name+'="'+a.target.attributes[d].value+'"')}else"style"!==a.target.attributes[d].name&&b.push(a.target.attributes[d].name);return b}(),classList:function(){var b=[],d;for(d in a.target.classList)a.target.classList.hasOwnProperty(d)&&b.push(a.target.classList[d]);return b}()};"traquer-playstop"!=b.id&&(b.selector=this.createSelector.call(b),document.querySelectorAll(b.selector)&&
(delete b.classList,delete b.attrs,delete b.targetType,this.recordedEvents.push(b),this.index++,this.logging&&console.log(b)))}"mouseup"==a.type&&(this.isMouseDown=!1)},createSelector:function(){var a;a=""+this.targetType;if(0<this.attrs.length)for(var b in this.attrs)if(this.attrs.hasOwnProperty(b))if("value"===this.attrs[b])a+="["+this.attrs[b]+'="'+this.value+'"]';else if(void 0!==this.attrs[b]){var c=this.attrs[b].match(/class/g)||this.attrs[b].match(/selected/g)||this.attrs[b].match(/over/g)||
this.attrs[b].match(/dirty/g)||this.attrs[b].match(/selectable/g);c||(a+="["+this.attrs[b]+"]")}if(0<this.classList.length)for(b in this.classList)this.classList.hasOwnProperty(b)&&((c=this.classList[b].match(/class/g)||this.classList[b].match(/selected/g)||this.classList[b].match(/over/g)||this.classList[b].match(/dirty/g)||this.classList[b].match(/selectable/g))||(a+="."+this.classList[b]));this.id&&(a=a+", "+("#"+this.id));return a},eventsScheduler:function(){var a=this;if(a.eventsInfo&&a.eventsEmitted<
a.eventsInfo.length){var b=a.eventsInfo[this.eventsEmitted],c=a.eventsInfo[this.eventsEmitted-1];setTimeout(function(){a.eventEmitter(b);a.eventsEmitted++;a.eventsScheduler()},c?b.time-c.time:b.time)}else a.isPlaying=!1,a.removeFakeCursor()},getIntersection:function(a,b){var c=a.getBoundingClientRect(),d=b.getBoundingClientRect?b.getBoundingClientRect():b,e=!1;c.left<=d.left+d.width&&d.left<=c.left+c.width&&(c.top<=d.top+d.height&&d.top<=c.top+c.height)&&(e=!0);return e},getOffset:function(a){a=a.getBoundingClientRect();
return{x:a.left,y:a.top,w:a.width,h:a.height}},pointRectangleIntersection:function(a,b){return a.x>b.x1&&a.x<b.x2&&a.y>b.y1&&a.y<b.y2},matchChild:function(a,b){var c;if(a&&a.childNodes)for(c in a.childNodes)if(a.childNodes.hasOwnProperty(c)){var d=a.childNodes[c];if(d==b)return!0;this.matchChild(d,b)}return!1},play:function(a){this.isPlaying||(this.isPlaying=!0,this.createFakeCursor(),this.eventsEmitted=0,this.eventsInfo=a,this.eventsScheduler())},eventEmitter:function(a){if(a){var b=document.querySelector(a.selector),
c=b?b:document.elementFromPoint(a.x,a.y),d=this.getFakeCursor(),e=new EventBase(this);d.style.top=a.y+"px";d.style.left=a.x+"px";b||console.warn("[f] Cant find element by dinosaurus selector method, probably not there.");if(this.previousElement){var b=this.matchChild(this.previousElement,c),d=this.getOffset(this.previousElement),g=this.getOffset(c);if(this.pointRectangleIntersection(g,{x1:d.x,x2:d.x+d.w,y1:d.y,y2:d.y+d.h})||b)a.stopPropagationFlag=!0;this.previousElement=null}else this.previousElement=
c.parentElement;switch(a.type){case "mousemove":case "mouseenter":case "mouseleave":case "mouseover":case "mousedown":case "mouseup":case "mouseout":case "click":case "contextmenu":e.mouseEvents(a,c);break;case "wheel":e.wheelEvents(a,c);break;case "focus":case "focusin":case "focusout":case "DOMFocusIn":case "DOMFocusOut":e.focusEvents(a,c);break;case "input":case "textinput":e.inputEvents(a,c);break;case "keypress":case "keydown":case "keyup":e.keyEvents(a,c);break;case "change":e.empty(a,c);break;
case "selectstart":case "selectionchange":e.focusEvents(a,c);break;case "scroll":case "select":case "DOMActivate":case "DOMSubtreeModified":case "DOMCharacterDataModified":e.UIEvents(a,c)}}},getFakeCursor:function(){return this.fakeCursor||this.createFakeCursor()},createFakeCursor:function(){this.fakeCursor=document.createElement("div");this.fakeCursor.style.height="10px";this.fakeCursor.style.width="10px";this.fakeCursor.style.background="red";this.fakeCursor.style.opacity="0.5";this.fakeCursor.style.display=
"block";this.fakeCursor.style.position="fixed";this.fakeCursor.style.borderRadius="10px";this.fakeCursor.style.zIndex="2147483647";document.body.appendChild(this.fakeCursor)},removeFakeCursor:function(){this.fakeCursor&&(document.body.removeChild(this.fakeCursor),delete this.fakeCursor)},toggleStopPropagation:function(a,b){var c=["mouseover","mouseenter","mouseleave","mouseout"];a.stopPropagationFlag&&-1<c.indexOf(a.type)&&b.stopPropagation()}};
