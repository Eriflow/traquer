window.addEventListener("load",function(){var a=document.createElement("div");a.className="traquer-recorder";a.id="traquer-recorder";controls=new Controls;controls.loadStyles();a.addEventListener("click",controls.recording.bind(this,controls));document.body.appendChild(a)});var Controls=function(){if(!(this instanceof Controls))return new Controls;this.traquer=new Traquer;this.styles=["base.css","timeline.css","recorder.css","player.css"]};
Controls.prototype.loadStyles=function(){var a=document.head.querySelectorAll("link"),b=!1,c;for(c in a)a.hasOwnProperty(c)&&-1<this.styles.indexOf(a[c].href)&&(b=!0);b||(a=document.createElement("link"),a.rel="stylesheet",a.type="text/css",a.href="http://localhost:3008/traquer.min.css",document.head.appendChild(a))};
Controls.prototype.recording=function(a,b){var c=a.traquer,e=b.target,d=document.querySelector(".player");c.isRecording?(d&&document.body.removeChild(d),e.className="traquer-recorder",c.stop(),a.timeline.call(a),a.player.call(a)):(c.start(),e.className="traquer-recorder squared")};
Controls.prototype.timeline=function(){var a=this.traquer.recordedEvents,b=document.querySelector("ol.timeline-container");b||(b=document.createElement("ol"),b.className="timeline-container",document.body.appendChild(b));b.innerHTML="";var c=b.getBoundingClientRect().width,e=a[a.length-1].time;this.tlcWidth=c;var d=2147E6,f=[],g="",m,l;for(l in a)if(a.hasOwnProperty(l)){var k=a[l],h=parseInt(100*(k.time/e)),h=parseInt(h*c/100),p="e_"+Math.random().toString(36).substring(3).substr(0,8),n=['<li id="'+
p+'"',' style="left: '+h+'px;"',' class="{css-class}">','<div class="tl-type" style="z-index: '+d++ +'">',"{title} {key} </div>",'<div class="tl-selector" style="z-index: '+d++ +'">',"{selector}</div></li>"].join(""),q="click"==k.type||"keydown"==k.type||"keyup"==k.type||"keypress"==k.type?"red":-1<k.type.indexOf("DOM")?"blue":-1<k.type.indexOf("select")?"green":"default",n=n.replace(/{title}/igm,k.type).replace(/{selector}/igm,k.selector).replace(/{key}/igm,k.raw.key||"").replace(/{css-class}/igm,
q),k={id:p,time:k.time,type:k.type,lastTimeLine:h};f.push(k);g+=n}b.innerHTML=g;for(l in f)f.hasOwnProperty(l)&&(k=f[l],a=k.type,d=k.id,h=parseInt(100*(k.time/e)),h=parseInt(h*c/100),m&&(h>m-10&&h<m+10)&&(m=b.querySelector("#"+d),d=m.previousSibling,h=window.getComputedStyle(m),d=window.getComputedStyle(d),h=Math.abs(Math.round(100*parseFloat(h.top.replace("px",""))/100)),d=Math.abs(Math.round(100*parseFloat(d.top.replace("px",""))/100)),g=0,"click"==a||"keydown"==a||"keyup"==a||"keypress"==a||-1<
a.indexOf("DOM")||-1<a.indexOf("select")?(d==h&&(g=h+8),d>h&&(g=d-h+4),d<h&&(g=h-d+4),g=-g):(d==h&&(g=h+18),d>h&&(g=d-h+38),d<h&&(g=h-d+38),g-=70),g+="px",m.style.cssText+="top: "+g+";"),m=k.lastTimeLine)};
Controls.prototype.player=function(){var a=this,b=a.traquer,c=b.recordedEvents;document.querySelector("ol.timeline-container");var e=document.querySelector(".timeline-track"),d=document.querySelector(".player");d||(d=document.createElement("div"),d.className="player",document.body.appendChild(d),d.innerHTML='<div class="play"></div>',b.playerTarget=d,d.addEventListener("stop",function(a){d.className="player"}),d.addEventListener("click",function(a,b){this.isPlaying?(this.stop(),d.className="player"):
(d.className+=" playing",this.play(a))}.bind(b,c)));e||(e=document.createElement("div"),e.className="timeline-track",document.body.appendChild(e),e.innerHTML='<div class="current-event"></div>',b.trackTarget=e,e.addEventListener("move",function(b){var c=b.detail.eventInfo,d=b.detail.last,e=c.time,k=a.tlcWidth,h=document.querySelector(".current-event"),d=parseInt(100*(e/d)),k=parseInt(d*k/100)+152;b.target.style.cssText="left: "+k+"px;";h.innerHTML=a.previousTime>e-2&&a.previousTime<e+2?h.innerHTML+
(c.type+"("+e+") <br />"):c.type+"("+e+") <br />";a.previousTime=e}))};"use strict";var EventBase=function(a){if(!(this instanceof EventBase))return new EventBase;if(!(a&&a instanceof Traquer))throw Error("Can't instantiate EventBase without Traquer instance!");this.traquer=a};
EventBase.prototype={getScrollTarget:function(a){for(;a!=document.body;){a=a.parentNode;var b=window.getComputedStyle(a);if(b&&"auto"==b["overflow-y"]&&a.scrollHeight>a.clientHeight)break}return a},shallowCopy:function(a,b){for(var c in b)try{a[c]=b[c]}catch(e){}return a},mouseEvents:function(a,b){var c=new MouseEvent(a.type,a.raw),c=this.shallowCopy(c,a.raw);this.traquer.toggleStopPropagation(a,c);b.dispatchEvent(c)},wheelEvents:function(a,b){b=this.getScrollTarget(b);var c=new WheelEvent("wheel",
a.raw),c=this.shallowCopy(c,a.raw);b.scrollLeft+=c.deltaX;b.scrollTop+=c.deltaY;b.dispatchEvent(c)},focusEvents:function(a,b){var c=-1<a.type.indexOf("FocusIn")?"focus":"blur";if(-1<a.type.indexOf("FocusIn")||-1<a.type.indexOf("FocusOut"))var e=setTimeout(function(){b.dispatchEvent(new FocusEvent(a.type,b));clearTimeout(e)},1);"focusin"!=a.type&&"DOMFocusIn"!=a.type||b.focus();"focusout"!=a.type&&"DOMFocusOut"!=a.type||b.blur();b.dispatchEvent(new FocusEvent(c,b))},inputEvents:function(a,b){var c=
new ("undefined"!=typeof InputEvent?InputEvent:Event)(a.type,a.raw),c=this.shallowCopy(c,a.raw);document.activeElement!=b&&(b=document.activeElement);b.value=void 0!=a.value?a.value:"";b.dispatchEvent(c)},keyEvents:function(a,b){var c=new KeyboardEvent(a.type,a.raw),c=this.shallowCopy(c,a.raw);document.activeElement!=b&&(b=document.activeElement);if(b.contentEditable&&"keypress"==a.type&&9!=a.raw.which){var e="";13==a.raw.which?(b.style.whiteSpace="pre",e="\r\r\n"):e=String.fromCharCode(a.raw.which);
b.textContent+=e}b.dispatchEvent(c)},UIEvents:function(a,b){var c=new UIEvent(a.type,a.raw);b.dispatchEvent(c)},selectionEvents:function(a,b){this.UIEvents(a,b)},event:function(a,b){var c=new Event(a.type,a.raw);b.dispatchEvent(c)}};"use strict";
var Traquer=function(){if(!(this instanceof Traquer))return new Traquer;this.index=0;this.logging=!1;this.recordedEvents=[];this.previousElement=null;this.eventNames="mousemove mouseenter mouseleave mouseover mousedown mouseup mouseout click scroll contextmenu wheel focus focusin focusout change input textinput keypress keydown keyup DOMFocusIn DOMFocusOut selectstart selectionchange select DOMActivate".split(" ");var a=document.createElement("div");a.className="traquer-base";document.body.appendChild(a)};
Traquer.prototype={isEventObservable:function(a){return a&&a.type?-1<this.eventNames.indexOf(a.type):!1},start:function(a){var b=this;b.isRecording=!0;b.recordingStartTime=(new Date).getTime();b.recordedEvents=[];b.mousePosition={x:0,y:0};var c=b.eventNames||[];b.processEventBinded=b.processEvent.bind(b);c.forEach(function(a){document.body.addEventListener(a,b.processEventBinded,!1)});document.addEventListener("mousemove",function(a){b.mousePosition.x=a.clientX;b.mousePosition.y=a.clientY});a&&(this.logging=
!0)},stop:function(){var a=this,b=a.eventNames||[];a.processEventBinded&&b.forEach(function(b){document.body.removeEventListener(b,a.processEventBinded,!1)});a.isRecording=!1;a.playerTarget&&(b=new Event("stop"),a.playerTarget.dispatchEvent(b));return this.recordedEvents},copyEventObject:function(a){var b={},c;for(c in a){var e=typeof a[c];"function"!=e&&"object"!=e&&(b[c]=a[c])}return b},processEvent:function(a){"mousedown"==a.type&&(this.isMouseDown=!0);if(this.isEventObservable(a)||this.isMouseDown){var b=
{index:this.index,x:this.mousePosition.x,y:this.mousePosition.y,time:(new Date).getTime()-this.recordingStartTime,raw:this.copyEventObject(a),type:a.type,id:a.target.id,targetType:a.target.tagName?a.target.tagName.toLowerCase():null,value:a.target.value||a.target.text,attrs:this.getAttributes(a.target),classList:this.getClassess(a.target)};"traquer-recorder"!=b.id&&(b.selector=this.createSelector.call(b,this),document.querySelectorAll(b.selector)&&(delete b.classList,delete b.attrs,delete b.targetType,
this.recordedEvents.push(b),this.index++,this.logging&&console.log(b)))}"mouseup"==a.type&&(this.isMouseDown=!1)},eventsScheduler:function(){var a=this;if(a.eventsInfo&&a.eventsEmitted<a.eventsInfo.length)var b=a.eventsInfo[this.eventsEmitted],c=a.eventsInfo[this.eventsEmitted-1],e=setTimeout(function(){a.eventEmitter(b);a.eventsEmitted++;a.eventsScheduler();clearTimeout(e)},c?b.time-c.time:b.time);else a.isPlaying=!1,a.removeFakeCursor()},play:function(a){this.isPlaying||(50>this.getSimilarity(a)&&
console.warn("[w] Current scenario is less than 50% similar to page you`re testing."),this.isPlaying=!0,this.createFakeCursor(),this.eventsEmitted=0,this.eventsInfo=a,this.eventsScheduler())},eventEmitter:function(a){if(a){var b=document.querySelector(a.selector),c=b?b:document.elementFromPoint(a.x,a.y),e=this.getFakeCursor(),d=new EventBase(this);e.style.top=a.y+"px";e.style.left=a.x+"px";b||console.warn("[f] Cant find element by current selector, probably not there.",a.selector);if(this.previousElement){var b=
this.matchChild(this.previousElement,c),e=this.getOffset(this.previousElement),f=this.getOffset(c);if(this.pointRectangleIntersection(f,{x1:e.x,x2:e.x+e.w,y1:e.y,y2:e.y+e.h})||b)a.stopPropagationFlag=!0;this.previousElement=null}else this.previousElement=c.parentElement;switch(a.type){case "mousemove":case "mouseenter":case "mouseleave":case "mouseover":case "mousedown":case "mouseup":case "mouseout":case "click":case "dblclick":case "contextmenu":d.mouseEvents(a,c);break;case "wheel":d.wheelEvents(a,
c);break;case "DOMFocusIn":case "DOMFocusOut":case "focusin":case "focus":case "focusout":case "blur":d.focusEvents(a,c);break;case "beforeinput":case "input":case "textinput":d.inputEvents(a,c);break;case "keypress":case "keydown":case "keyup":case "nothing":d.keyEvents(a,c);break;case "change":d.event(a,c);break;case "selectstart":case "selectionchange":d.focusEvents(a,c);break;case "scroll":case "select":case "DOMMouseScroll":case "DOMActivate":case "DOMSubtreeModified":case "DOMCharacterDataModified":d.UIEvents(a,
c)}c=new CustomEvent("move",{detail:{eventInfo:a,last:this.recordedEvents[this.recordedEvents.length-1].time}});this.trackTarget.dispatchEvent(c)}this.recordedEvents.indexOf(a)==this.recordedEvents.length-1&&this.stop()},getFakeCursor:function(){return this.fakeCursor||this.createFakeCursor()},createFakeCursor:function(){this.fakeCursor=document.createElement("div");this.fakeCursor.style.height="10px";this.fakeCursor.style.width="10px";this.fakeCursor.style.background="red";this.fakeCursor.style.opacity=
"0.5";this.fakeCursor.style.display="block";this.fakeCursor.style.position="fixed";this.fakeCursor.style.borderRadius="10px";this.fakeCursor.style.zIndex="2147483647";document.body.appendChild(this.fakeCursor)},removeFakeCursor:function(){this.fakeCursor&&(document.body.removeChild(this.fakeCursor),delete this.fakeCursor)},toggleStopPropagation:function(a,b){var c=["mouseover","mouseenter","mouseleave","mouseout"];a.stopPropagationFlag&&-1<c.indexOf(a.type)&&b.stopPropagation()},getAttributes:function(a){var b=
[],c;for(c in a.attributes)if(a.attributes.hasOwnProperty(c)&&"style"!==a.attributes[c].name&&a.attributes[c].value){var e=a.attributes[c].value.match(/<.*?[\s\S]*?>[\s\S]*?<\/.*>/g),d=a.attributes[c].value.match(/(http:).*/g),f=a.attributes[c].name.match(/data-.*/g);"id"!=a.attributes[c].name&&(null==e&&null==d&&null==f)&&b.push(a.attributes[c].name+'="'+a.attributes[c].value+'"')}return b},getClassess:function(a){var b=[],c;for(c in a.classList)a.classList.hasOwnProperty(c)&&b.push(a.classList[c]);
return b},getSelector:function(a,b,c,e){var d="";if(0<a.length)for(var f in a)if(a.hasOwnProperty(f))if("value"===a[f])d+="["+a[f]+'="'+c+'"]';else if(void 0!==a[f]){var g=a[f].match(/class/g)||a[f].match(/selected/g)||a[f].match(/over/g)||a[f].match(/dirty/g)||a[f].match(/selectable/g)||a[f].match(/href/g)||a[f].match(/valign/g)||a[f].match(/role/g)||a[f].match(/tabindex/g);g||(d+="["+a[f]+"]")}if(0<b.length)for(f in b)b.hasOwnProperty(f)&&((g=b[f].match(/selected/g)||b[f].match(/over/g)||b[f].match(/dirty/g)||
b[f].match(/selectable/g)||b[f].match(/focused/g)||b[f].match(/focus/g))||(d+="."+b[f]));e&&(d+="#"+e);return d},createSelector:function(a){var b=this.targetType+a.getSelector(this.attrs,this.classList,this.value,this.id),c=document.querySelectorAll(b),e;if(1<c.length)for(var d in c)if(c.hasOwnProperty(d)&&c[d].getBoundingClientRect){var f=!1,g=c[d],m="",l=g.getBoundingClientRect(),k={height:10,left:a.mousePosition.x,top:a.mousePosition.y,width:10};if(0==l.bottom&&0==l.height&&0==l.left&&0==l.right&&
0==l.top&&0==l.width)for(l=window.getComputedStyle(g,"");d<l.length;d++)"display"==l[d]&&"none"==l.getPropertyValue(l[d])&&(m=l[d],g.setAttribute("style","display: block;"),f=!0);a.getIntersection(g,k,f)&&(e=g.parentElement.parentElement?g.parentElement.parentElement:g.parentElement);f&&g.setAttribute("style","display: "+m+";")}e&&(c=a.getAttributes(e),d=a.getClassess(e),c.length&&d.length&&(b=a.getSelector(c,d,e.value,e.id)+" > "+b));return b},getIntersection:function(a,b){var c=a.getBoundingClientRect(),
e=b.getBoundingClientRect?b.getBoundingClientRect():b,d=!1;c.left<=e.left+e.width&&e.left<=c.left+c.width&&(c.top<=e.top+e.height&&e.top<=c.top+c.height)&&(d=!0);return d},getOffset:function(a){a=a.getBoundingClientRect();return{x:a.left,y:a.top,w:a.width,h:a.height}},pointRectangleIntersection:function(a,b){return a.x>b.x1&&a.x<b.x2&&a.y>b.y1&&a.y<b.y2},matchChild:function(a,b){var c;if(a&&a.childNodes)for(c in a.childNodes)if(a.childNodes.hasOwnProperty(c)){var e=a.childNodes[c];if(e==b)return!0;
this.matchChild(e,b)}return!1},getSimilarity:function(a){var b=0,c=0,e;for(e in a)a.hasOwnProperty(e)&&(c=document.querySelector(a[e].selector))&&"hidden"!=window.getComputedStyle(c).visibility&&b++;return c=100*(b/a.length)}};
